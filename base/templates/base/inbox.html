{% extends 'main.html' %}

{% block content %}
<style>
  .inbox-container {
    display: flex;
    max-width: 1200px;
    margin: 0 auto;
  }
  .inbox {
    flex: 1;
    border-right: 1px solid #6e6a6a;
    padding-right: 20px;
  }
  .message-view {
    flex: 2;
    padding-left: 20px;
    min-height: 400px;
    height: 400px; /* Set a fixed height according to your needs */
    overflow-y: auto;
  }

  .message__subject {
    font-weight: bold;
    color: aqua;
  }
  .message__avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 10px;
  }
  .message-view-top {
    margin-top: 20px; /* Adjust this value according to your needs */
  }
</style>

<main class="create-room layout">
  <div class="container">
    <div class="layout__box">
      <div class="layout__boxHeader">
        <div class="layout__boxTitle">
          <a href="{% url 'home' %}">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
              <title>arrow-left</title>
              <path
                d="M13.723 2.286l-13.723 13.714 13.719 13.714 1.616-1.611-10.96-10.96h27.625v-2.286h-27.625l10.965-10.965-1.616-1.607z">
              </path>
            </svg>
          </a>
          <h3>Inbox</h3>
        </div>
      </div>

      <div class="inbox-container layout__body">
        <div class="inbox">
          <ul class="messages">
            {% for message in messageRequests %}
            {% if message.is_read == False %}
            <li class="message message--unread" data-message-id="{{message.id}}">
              {% else %}
            <li class="message" data-message-id="{{message.id}}">
              {% endif %}
              <img class="message__avatar" src="{{message.user.avatar.url}}" alt="{{message.user.username}}'s avatar">
              <span class="message__author">{{message.name}}</span>
              <span class="message__subject">{{message.subject}}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        <div class="message-view message-view-top">
          <!-- Message view will be updated here -->
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  document.querySelectorAll('.message').forEach((message) => {
    message.addEventListener('click', (event) => {
      event.preventDefault();
      const messageId = message.getAttribute('data-message-id');
      
      // Fetch the message content
      fetch(`/message/${messageId}/`) // Update this URL with the correct route to fetch the message
        .then((response) => response.text())
        .then((html) => {
          // Update the message view with the fetched content
          document.querySelector('.message-view').innerHTML = html;
        })
        .catch((error) => {
          console.error('Error fetching message:', error);
        });
    });
  });
</script>

<script src="script.js"></script>
{% endblock content %}